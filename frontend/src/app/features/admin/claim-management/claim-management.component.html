<div>
  <div class="flex justify-between items-center mb-6 flex-wrap gap-3">
    <h2 class="text-2xl text-gray-900">Claims Review</h2>
  </div>

  <div *ngIf="feedbackMessage" class="bg-blue-50 border border-blue-200 text-blue-800 rounded p-4 mb-6">
    {{ feedbackMessage }}
  </div>

  <div class="bg-white rounded-lg shadow p-4 mb-6">
    <div class="flex gap-2 flex-wrap">
      <button
        *ngFor="let option of statusFilters"
        (click)="setFilter(option.value)"
        class="px-4 py-2 rounded"
        [ngClass]="filterStatus === option.value
          ? 'bg-blue-600 text-white'
          : 'bg-white text-gray-700 border border-gray-300'">
        {{ option.label }}
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="bg-white rounded-lg shadow p-6 text-center text-gray-600">
    Loading claims...
  </div>

  <div *ngIf="error" class="bg-red-50 border border-red-200 text-red-700 rounded p-4">
    {{ error }}
  </div>

  <div *ngIf="!loading && !error && filteredClaims.length === 0" class="bg-white rounded-lg shadow p-8 text-center">
    <p class="text-gray-600">No claims found matching your criteria.</p>
  </div>

  <div *ngIf="!loading && !error && filteredClaims.length > 0" class="space-y-6">
    <div *ngFor="let claim of filteredClaims" class="bg-white rounded-lg shadow p-6 border border-gray-200">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h3 class="text-xl text-gray-900 mb-1">Claim #{{ claim.claimNumber }}</h3>
          <p class="text-sm text-gray-600">User: {{ claim.userId }}</p>
          <p class="text-sm text-gray-600">Policy: {{ claim.policy.policyNumber || claim.policyId }}</p>
        </div>
        <span class="px-3 py-1 rounded text-sm" [ngClass]="getStatusBadgeClass(claim.status)">
          {{ claim.status }}
        </span>
      </div>

      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3 text-sm mb-4">
        <div>
          <p class="text-sm text-gray-600">Claim Amount</p>
          <p class="text-gray-900 text-lg">{{ formatCurrency(claim.amount) }}</p>
        </div>
        <div>
          <p class="text-sm text-gray-600">Submitted</p>
          <p class="text-gray-900">{{ formatDate(claim.submittedDate) }}</p>
        </div>
        <div *ngIf="claim.reviewedDate">
          <p class="text-sm text-gray-600">Reviewed</p>
          <p class="text-gray-900">{{ formatDate(claim.reviewedDate) }}</p>
        </div>
      </div>

      <div class="mb-4">
        <p class="text-sm text-gray-600 mb-1">Description</p>
        <p class="text-gray-900">{{ claim.description }}</p>
      </div>

      <div *ngIf="claim.reviewNotes" class="bg-gray-50 rounded p-3 mb-4">
        <p class="text-sm text-gray-600 mb-1">Review Notes</p>
        <p class="text-gray-900 whitespace-pre-line">{{ claim.reviewNotes }}</p>
      </div>

      <div class="border-t border-gray-200 pt-4">
        <ng-container *ngIf="(claim.status === 'PENDING' || claim.status === 'UNDER_REVIEW') && selectedClaimId === claim.id; else actionButtons">
          <div class="mb-3">
            <label class="block text-sm text-gray-700 mb-2">Review Notes</label>
            <textarea
              [value]="reviewNotes"
              (input)="reviewNotes = $any($event.target).value"
              rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded"
              placeholder="Add your review notes here..."
              [disabled]="submittingReview"></textarea>
          </div>
          <div class="flex gap-3 flex-wrap">
            <button
              (click)="submitReview('APPROVED', claim)"
              class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-400"
              [disabled]="submittingReview">
              {{ submittingReview ? 'Saving...' : 'Approve Claim' }}
            </button>
            <button
              (click)="submitReview('REJECTED', claim)"
              class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:bg-gray-400"
              [disabled]="submittingReview">
              {{ submittingReview ? 'Saving...' : 'Reject Claim' }}
            </button>
            <button
              (click)="cancelReview()"
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded hover:bg-gray-50"
              [disabled]="submittingReview">
              Cancel
            </button>
          </div>
        </ng-container>
        <ng-template #actionButtons>
          <div class="flex gap-3 flex-wrap">
            <button
              *ngIf="claim.status === 'PENDING' || claim.status === 'UNDER_REVIEW'"
              (click)="startReview(claim.id)"
              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
              Review Claim
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
